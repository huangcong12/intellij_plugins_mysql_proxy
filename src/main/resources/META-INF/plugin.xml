<!-- Plugin Configuration File. Read more: https://plugins.jetbrains.com/docs/intellij/plugin-configuration-file.html -->
<idea-plugin require-restart="true">
    <!-- Unique identifier of the plugin. It should be FQN. It cannot be changed between the plugin versions. -->
    <id>com.ls.akong.mysql_proxy</id>

    <!-- Public plugin name should be written in Title Case.
         Guidelines: https://plugins.jetbrains.com/docs/marketplace/plugin-overview-page.html#plugin-name -->
    <name>MySQL Proxy</name>

    <!-- A displayed Vendor name or Organization ID displayed on the Plugins Page. -->
    <vendor email="huangcong12@gmail.com" url="https://huangcong12.github.io/#/">wuqing</vendor>

    <product-descriptor code="PMYSQLPROXY" release-date="20230903" release-version="10"/>

    <!-- Description of the plugin displayed on the Plugin Page and IDE Plugin Manager.
         Simple HTML elements (text formatting, paragraphs, and lists) can be added inside of <![CDATA[ ]]> tag.
         Guidelines: https://plugins.jetbrains.com/docs/marketplace/plugin-overview-page.html#plugin-description -->
    <description><![CDATA[
        <h3> Tool for Monitoring Code Execution CURD. </h3>
        <br/>
        <p> During the process of API development, whether it's troubleshooting or debugging, it's crucial to know which SQL statements have just been executed. While some modern frameworks make this information easily accessible, dealing with older frameworks can be quite cumbersome. This tool was born to address the challenge of quickly inspecting executed SQL statements within legacy frameworks. With its assistance, every SQL statement within older frameworks can be effortlessly revealed.</p>
        <br/>
        <p> Suitable Frameworks:</p>

        <p> PHP:</p>
        <ul>
            <li> Supports any framework, including: WordPress, Laravel, CI, Yii, ThinkPHP, and custom frameworks.</li>
        </ul>

        <p> Go:</p>
        <ul>
            <li> Frameworks using GORM (Tested with go-admin)</li>
        </ul>

        <p> Java (To be tested):</p>

        <p> Python:</p>
        <ul>
            <li> Django (Tested and passed).</li>
        </ul>

        <hr/>
        <h3> Initial Setup Steps:</h3>
        <ul>
            <li> Check the bottom toolbar of your editor to see if there is an icon resembling a fish head (it should be located next to Git, TODO, Problems, and Terminal). Click on it to open the plugin's page.</li>
            <li> Click on the "Modify Run Configuration" button in the left button group and configure the remote MySQL server information in the popup: Remote MySQL Server IP Address, Remote MySQL Server Port, and the local listening port: Proxy Listener Port.</li>
            <li> Return to the left button group and click on "Start 'Mysql Proxy Server'" to initiate the proxy service. If you see a green dot next to the fish head icon, it indicates successful startup.</li>
            <li> Now, go back to your project's code and modify the database connection configuration (usually found in the Config folder's Database configuration file) to use the local IP and the "Proxy Listener Port" you configured earlier.</li>
            <li> Restart your project (if necessary) and execute your MySQL queries to check if SQL logs are being monitored correctly. With this, the configuration process is complete. If you still cannot see clear SQL logs, please refer to the FAQ below.</li>
        </ul>
        <hr/>
        <h3> Usage Recommendations:</h3>
        <ul>
            <li> After the initial installation, you'll need to configure the remote MySQL's IP, port, and the local proxy listening port. Once configured, please check the "Start Proxy Service with Editor" option. This way, you won't need to start it manually in the future. For the initial installation, you'll need to manually click "Start 'Mysql Proxy Server'".</li>
            <li> If you don't need to view SQL logs temporarily, click the "Stop Recording SQL" switch. When needed, you can reopen the logging.</li>
            <li> If the logged entries exceed 100,000, click the "Clear All Sql Log" button to restart logging from 1 and free up system resources.</li>
            <li> If you wish to copy SQL, besides using Ctrl + C to copy the entire line, you can also right-click and choose "Copy SQL." If there are SQL statements you'd rather not see, you can right-click to delete them or add them to the filter table. Once added to the filter table, they will no longer appear unless you remove them from the filter table.</li>
        </ul>

        <hr/>
        <h3> FAQ:</h3>
        <strong> Q: I followed the documentation, configured everything, and started the proxy service, but I can't see the SQL logs.</strong>
        <p> A: Possible reasons:</p>
        <ul>
            <li> 1.The MySQL connection in your code might not have been adjusted to the proxy's address. Please double-check and try stopping the proxy service to see if your code can connect to the database.</li>
            <li> 2.It's possible that your framework has disabled the logging feature. Check the third button in the left button group to see if it reads "Recording Synchronized SQL In Progress" and has a small green dot.</li>
            <li> 3.If both of the above points are correctly configured and you still encounter issues, please provide us with information about your database version, code framework, etc. If we identify the problem, we will address it in the next version.</li>
        </ul>
        <br/>
        <strong> Q: My SQL logs appear as garbled text. How can I resolve this?</strong>
        <p> A: The database packets are encrypted. Please add the parameter "useSSL=false" to your MySQL connection, like this: "jdbc:mysql://localhost:3309?useSSL=false."</p>
        <br/>
        <strong> Q: What versions of MySQL are supported?</strong>
        <p> A: We have tested it with MySQL 5.7 and MySQL 8.0, and theoretically, it should support all databases using the MySQL protocol, such as MariaDB and TiDB.</p>
        <br/>
        <strong> Q: Can I use my own custom framework with this?</strong>
        <p> A: We recommend giving it a try. If you find that SQL logs appear as garbled text, please add the parameter "useSSL=false" to your configuration, like this: "jdbc:mysql://localhost:3309?useSSL=false." If it still doesn't work, it might not be supported. You can provide us with your process and results, and we will work on optimizations in the next version.</p>

]]></description>

    <change-notes><![CDATA[
    <p>
        <ul>
            <li><strong>Important Note:</strong> You can report exception-issues directly from your IDE. Please add at least a comment what you have done when it occurred / how you can reproduce it. It would be even better when add an email address so I can contact you in case of questions. </li>

            <li> 1.0.3 </li>
            <ul>
                <li>Added parsing functionality for prepared data packets.</li>
                <li>Optimized TableView display by showing only the first 500 characters of very long SQL statements to prevent excessive resource consumption.</li>
                <li>Fixed a bug related to incorrect handling of combined MySQL data packet sending.</li>
                <li>Fixed a bug where the plugin didn't start correctly with the editor.</li>
                <li>Fixed bugs related to duplicate or missing data in the TableView.</li>
            </ul>
            <li> 1.0.2 </li>
            <ul>
                <li>adjusting the data type for saving SQL logs.</li>
            </ul>
        </ul>
    </p>
]]></change-notes>

    <!-- Product and plugin compatibility requirements.
         Read more: https://plugins.jetbrains.com/docs/intellij/plugin-compatibility.html -->
    <depends>com.intellij.modules.platform</depends>

    <!-- Extension points defined by the plugin.
         Read more: https://plugins.jetbrains.com/docs/intellij/plugin-extension-points.html -->
    <extensions defaultExtensionNs="com.intellij">
        <toolWindow id="MySQL Proxy" icon="/icons/logo.svg" anchor="bottom"
                    factoryClass="com.ls.akong.mysql_proxy.ui.SqlToolWindowFactory"/>
        <projectConfigurable
                parentId="tools"
                id="com.kong.mycompany.mysql_proxy.MysqlProxyConfigurable"
                displayName="MySQL Proxy Settings"
                instance="com.ls.akong.mysql_proxy.ui.MysqlProxyConfigurable"/>
    </extensions>

    <actions>
        <group id="MysqlProxy.LeftToolbar" text="Left Tool Bar">
            <action class="com.ls.akong.mysql_proxy.ui.action.RunOrStopServerAction" id="StopServer"
                    text="Stop Sql Proxy Server" description="Stop sql proxy server"
                    icon="/icons/suspend.svg"/>
            <action class="com.ls.akong.mysql_proxy.ui.action.CleanSqlLogAction" id="CleanSqlLog"
                    text="Clear All Sql Log"
                    description="Clean up all sql logs in the record" icon="/icons/clean_all.svg"/>
            <action class="com.ls.akong.mysql_proxy.ui.action.RecordingSwitchAction" id="RecordingSwitch"
                    text="Pause/Record the Sql Log"
                    description="Pause/record the sql log"
                    icon="com.intellij.execution.testframework.sm.runner.ui.SMPoolOfTestIcons.RUNNING_ICON"/>
            <action class="com.ls.akong.mysql_proxy.ui.action.SettingServerAction" id="SettingServer"
                    text="Modify Run Configuration" description="Modify run configuration"
                    icon="AllIcons.General.Settings"/>

            <separator/>
            <action class="com.ls.akong.mysql_proxy.ui.action.RefreshTableViewAction" id="RefreshTableView"
                    text="Reload the Table Data"
                    description="Reload the table data" icon="AllIcons.Actions.Refresh"/>
            <action class="com.ls.akong.mysql_proxy.ui.action.ScrollToTopAction" id="ScrollToTop"
                    text="Scroll to Top of the Table"
                    description="Scroll to Top of the Table" icon="/icons/top.svg"/>

<!--            <action class="com.ls.akong.mysql_proxy.ui.action.CheckDataAction" id="CheckData"-->
<!--                    text="开发用：检查 Table View Data 是否有重复的，如果您看到了这个按钮，说明打包有误，请忽略"-->
<!--                    description="Scroll to Top of the Table" icon="AllIcons.Debugger.AttachToProcess"/>-->
        </group>
    </actions>
    <!-- 注册跟随编辑器启动 -->
    <project-components>
        <component>
            <implementation-class>com.ls.akong.mysql_proxy.services.MySQLToolWindowListener</implementation-class>
        </component>
    </project-components>
</idea-plugin>